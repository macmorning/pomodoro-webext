name: Package Extension

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  workflow_dispatch:

jobs:
  package:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v3
    
    - name: Create Chrome package
      run: |
        mkdir -p dist/chrome
        # Copy Chrome-specific manifest
        cp manifest.json dist/chrome/
        # Copy core extension files
        cp background.js dist/chrome/
        cp pomodoro.js dist/chrome/
        cp pomodoro.html dist/chrome/
        cp pomodoro.css dist/chrome/
        cp options.js dist/chrome/
        cp options.html dist/chrome/
        cp news.js dist/chrome/
        cp news.html dist/chrome/
        cp news.json dist/chrome/
        cp offscreen.js dist/chrome/
        cp offscreen.html dist/chrome/
        # Copy directories
        cp -r icons dist/chrome/
        cp -r sound dist/chrome/
        cd dist/chrome
        zip -r ../pomodoro-chrome.zip .
    
    - name: Create Firefox package
      run: |
        mkdir -p dist/firefox
        # Copy Firefox-specific manifest
        cp manifest-firefox.json dist/firefox/manifest.json
        # Copy core extension files
        cp background.js dist/firefox/
        cp pomodoro.js dist/firefox/
        cp pomodoro.html dist/firefox/
        cp pomodoro.css dist/firefox/
        cp options.js dist/firefox/
        cp options.html dist/firefox/
        cp news.js dist/firefox/
        cp news.html dist/firefox/
        cp news.json dist/firefox/
        cp offscreen.js dist/firefox/
        cp offscreen.html dist/firefox/
        # Copy directories
        cp -r icons dist/firefox/
        cp -r sound dist/firefox/
        cd dist/firefox
        zip -r ../pomodoro-firefox.zip .
    
    - name: Create Chromium package
      run: |
        mkdir -p dist/chromium
        # Copy Chromium-specific manifest (if different from Chrome)
        if [ -f manifest-chromium.json ]; then
          cp manifest-chromium.json dist/chromium/manifest.json
        else
          cp manifest.json dist/chromium/
        fi
        # Copy core extension files
        cp background.js dist/chromium/
        cp pomodoro.js dist/chromium/
        cp pomodoro.html dist/chromium/
        cp pomodoro.css dist/chromium/
        cp options.js dist/chromium/
        cp options.html dist/chromium/
        cp news.js dist/chromium/
        cp news.html dist/chromium/
        cp news.json dist/chromium/
        cp offscreen.js dist/chromium/
        cp offscreen.html dist/chromium/
        # Copy directories
        cp -r icons dist/chromium/
        cp -r sound dist/chromium/
        cd dist/chromium
        zip -r ../pomodoro-chromium.zip .
    
    - name: Upload Chrome package
      uses: actions/upload-artifact@v3
      with:
        name: pomodoro-chrome
        path: dist/pomodoro-chrome.zip
    
    - name: Upload Firefox package
      uses: actions/upload-artifact@v3
      with:
        name: pomodoro-firefox
        path: dist/pomodoro-firefox.zip
    
    - name: Upload Chromium package
      uses: actions/upload-artifact@v3
      with:
        name: pomodoro-chromium
        path: dist/pomodoro-chromium.zip
