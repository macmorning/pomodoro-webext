name: Package Extension

on:
  release:
    types: [published]

jobs:
  package:
    runs-on: ubuntu-latest
    
    steps:
    - name: Show context
      run: |
        echo github.event.action = ${{ github.event.action }}
        echo github.event_name = ${{ github.event_name }}

    - name: Checkout code
      uses: actions/checkout@v4

    - name: Create Firefox package
      run: |
        mkdir -p dist/firefox
        # Copy Firefox-specific manifest
        cp manifest-firefox.json dist/firefox/manifest.json
        # Copy core extension files
        cp background.js dist/firefox/
        cp pomodoro.js dist/firefox/
        cp pomodoro.html dist/firefox/
        cp pomodoro.css dist/firefox/
        cp options.js dist/firefox/
        cp options.html dist/firefox/
        cp news.js dist/firefox/
        cp news.html dist/firefox/
        cp news.json dist/firefox/
        cp offscreen.js dist/firefox/
        cp offscreen.html dist/firefox/
        # Copy directories
        cp -r icons dist/firefox/
        cp -r sound dist/firefox/
        cd dist/firefox
        zip -r ../pomodoro-firefox.zip .
    
    - name: Create Chromium package
      run: |
        mkdir -p dist/chromium
        # Copy Chromium-specific manifest (if different from Chrome)
        cp manifest-chromium.json dist/chromium/manifest.json
        # Copy core extension files
        cp background.js dist/chromium/
        cp pomodoro.js dist/chromium/
        cp pomodoro.html dist/chromium/
        cp pomodoro.css dist/chromium/
        cp options.js dist/chromium/
        cp options.html dist/chromium/
        cp news.js dist/chromium/
        cp news.html dist/chromium/
        cp news.json dist/chromium/
        cp offscreen.js dist/chromium/
        cp offscreen.html dist/chromium/
        # Copy directories
        cp -r icons dist/chromium/
        cp -r sound dist/chromium/
        cd dist/chromium
        zip -r ../pomodoro-chromium.zip .
    
    - name: Upload Firefox package
      uses: actions/upload-artifact@v4
      with:
        name: pomodoro-firefox
        path: dist/pomodoro-firefox.zip
    
    - name: Upload Chromium package
      uses: actions/upload-artifact@v4
      with:
        name: pomodoro-chromium
        path: dist/pomodoro-chromium.zip
